# StructuralVariation_ShinyApp

## Last Updated - 10/12/22

In order to easily visualize structural variation between the 26 lines of the maize [Nested Association Mapping](https://www.science.org/doi/10.1126/science.abg5289) (NAM) population, I constructed a R Shiny App which reads in parsed and filtered gvcf outputs from [AnchorWave](https://github.com/baoxingsong/AnchorWave), gff gene annotations, and [EDTA](https://github.com/oushujun/EDTA). It then leverages the R package [gggenomes](https://github.com/thackl/gggenomes) to visualize nonvariant and structural variants ( > 75 bp) between two maize lines for a user supplied region.

As of 10/12/22, this app supports comparisons between B73 and any of the other 25 NAM lines. It currently only supports two line comparisons, one of which must be B73. The app only visualizes one region at a time, inputed as either chr#:1234..5678 or Chr#:1,234..5,678 allowing for easy copying of coordinates from either JBrowse or GBrowse in maizeGDB. 

We summarise the AnchorWave gvcf output accordingly. We condense true nonvariant regions with SNPs and small InDels (<50 bp) into one larger alignable region. We require structural insertions to have inserted sequence (>50 bp) in one genotype that maps back to a single position in the other genotype. If it did not map back to a single position, we considered that region to be unalignable sequence. 

Users must select two genotpyes, one of which must be B73, and supply a region of interest (chr#:start..end). The browser will extract and visualize the AnchorWave output for that region. It then overlays exon/intron structure (colored in dark blue) for the canonical transcripts of any genes in the user-selected region. Finally, it also overlays tracks showing annotated transposable elements (colored in yellow) fully encapsualted in the region as well. These TE annotations derive from the EDTA TE annotations generated as part of the NAM project; however, they have been extensively filtered to remove low-quality or questionable annotations. Further information on all aspects of the visualizations is outputted underneath in a series of tables. 

This Shiny app is very much still in development, and I anticipate that there may be comparisons made that break the app. If you identify any trends in regions that break the app or would like me to investigate a specific region in particular, please contact me at mmunasin@umn.edu. 

## Find R Shiny App AnchorWave Identified Structural Variation in NAM [Here](https://mmunasin.shinyapps.io/nam_sv/)

## Updates
10/12/22 - We now output warning messages if the user supplied endpoints fall within a TE/Gene. These features will not be visualized, but suggested endpoints will be supplied if the user wishes to zoom out and include them.

10/12/22 - We now ensure that the outputted visualization begins and ends with the user supplied endpoints, instead of pushing out to the edge of whichever AnchorWave block they fall into. This requires that the supplied endpoints fall into either an alignable region or a structural insertion region. If the endpoints falls into an unalignable region, an error will now be thrown that suggests more appropriate endpoints.

10/12/22 - We now classify unalignable regions in the AnchorWave output through inference where alignable regions end. Structural insertions now connect a single position in one genotype to a >50 bp long variant in the other genotype. 

05/20/22 - Added warning messages if user inputs are not viable

05/19/22 - Fixed bug that caused the app to break when visualizing regions that were fully a structural variant (i.e., if you supplied exact coordinates for a TE present in one line but not hte other)

05/19/22 - Fixed bug that caused the app to break when visualizing regions where one lineage had no TEs

05/18/22 - Accepts two forms of coordinate inputs to match those generated by JBrowse and GBrowse from maizeGDB

05/18/22 - Adjusted variant classification to call variants larger than 75 bp (formerly 100 bp) as structural variants

05/18/22 - Fixed bug that caused the app to break when visualizing regions with no genes

05/18/22 - Fixed bug that caused Oh7B to fail

05/18/22 - Updated app aesthetic using shinydashboard